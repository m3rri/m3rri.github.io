{"pageProps":{"post":{"id":"20230526","content":"\n## MapStructë¡œ dto ë§¤í•‘ ì§€ì˜¥ íƒˆì¶œ\n\n### ì ìš© ë°°ê²½\n\n-   í”„ë¡œì íŠ¸ ê°œë°œ ì¤‘ ë³€ìˆ˜ê°€ 40ê°œ ì´ìƒì´ë˜ëŠ” í…Œì´ë¸”ì„ ì¡°íšŒí•´ì„œ DTOë¡œ ë³€í™˜ í›„ ë¦¬í„´í•´ì¤˜ì•¼í•˜ëŠ” APIë¥¼ ë§Œë‚¬ë‹¤\n-   getter setter ì¢ì¢ íƒ€ì´í•‘í•  ìƒê°ì— ì •ì‹ ì´ ì•„ë“í•´ì ¸ì„œ êµ¬ê¸€ë§ìœ¼ë¡œ Entity to Dto ë¥¼ ê²€ìƒ‰í–ˆë‹¤\n-   ModelMapper ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë°œê²¬ í›„ ì ìš©í•´ë³´ë ¤ëŠ”ë° ë‚˜ë‘ ë„ˆë¬´ ì•ˆë§ì•„ì„œ ë‹¤ë¥¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì°¾ì•„ë³´ì•˜ê³  ê·¸ê²ƒì´ MapStructì´ë‹¤\n\n### MapStruct ì‹œì‘í•˜ê¸°\n\n1. ì˜ì¡´ì„± ì¶”ê°€í•˜ê¸° `build.gradle`\n\n    lombok ì‚¬ìš©í•˜ëŠ” ê²½ìš° ì‘ì„± ìˆœì„œê°€ ë§¤ìš° ì¤‘ìš”í•˜ë‹¤ ğŸ‘‰ lombok ì´í›„ì— ì •ì˜\n\n    ```gradle\n    dependencies {\n        ...\n        implementation 'org.projectlombok:lombok'\n        annotationProcessor 'org.projectlombok:lombok'\n        implementation 'org.mapstruct:mapstruct:1.5.3.Final'\n        annotationProcessor 'org.mapstruct:mapstruct-processor:1.5.3.Final'\n        ...\n    }\n    ```\n\n2. Mapper interface ì‘ì„±\n\n    ```java\n    import org.mapstruct.Mapper;\n    import org.mapstruct.Mapping;\n    import org.mapstruct.factory.Mappers;\n\n    @Mapper //ì–´ë…¸í…Œì´ì…˜ ì ìš©\n    public interface ConditionsMapper {\n        ConditionsMapper INSTANCE = Mappers.getMapper(ConditionsMapper.class);\n        // Mappers.getMapper()ë¡œ ì‹±ê¸€í†¤ ìƒì„±í•˜ì—¬ INSTANCEë¥¼ í˜¸ì¶œí•´ì„œ ì‚¬ìš©\n\n        /* abstract method ì •ì˜\n         * @Mapping : í•´ë‹¹ ì–´ë…¸í…Œì´ì…˜ì„ í†µí•´ ë³€ìˆ˜ ì´ë¦„ë§Œìœ¼ë¡œ ìƒì„±ëœ getter, setterë§Œìœ¼ë¡œ ë§¤í•‘ì´ ë¶ˆê°€ëŠ¥í•œ ê²½ìš°ë¥¼ ì •ì˜\n         *  * source : methodì˜ íŒŒë¼ë¯¸í„°ì¤‘ì—ì„œ ì–´ë–¤ íŒŒë¼ë¯¸í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ ë§¤í•‘í•  ê²ƒì¸ì§€ ëª…ì‹œí•˜ë©´ ë¨\n              ì˜ˆì‹œ ì½”ë“œì—ì„œëŠ” method íŒŒë¼ë¯¸í„°ê°€ 1ê°œì´ì§€ë§Œ, 2ê°œ ì´ìƒì˜ ê°ì²´ë¥¼ ë°›ì•„ì„œ í•˜ë‚˜ì˜ target ê°ì²´ë¡œ ë§¤í•‘í•˜ëŠ” ê²½ìš°ë„ ì •ì˜í•  ìˆ˜ ìˆë‹¤.\n              ë‹¨, í•˜ë‚˜ì˜ @Mapping source ì†ì„±ì—ì„œ í•˜ë‚˜ì˜ íŒŒë¼ë¯¸í„° ê°ì²´ë§Œ ë‹¤ë£° ìˆ˜ ìˆìŒ -> @Mapping ì—¬ëŸ¬ê°œë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ\n         *  * target : methodì˜ ë¦¬í„´ íƒ€ì…\n         */\n        @Mapping(source = \"condition.equipmentType\", target = \"equipmentType\", qualifiedByName = \"equipmentTypeToString\")\n        /* â˜ sourceìª½ ê°ì²´ì—ì„œ equipmentTypeì´ë¼ëŠ” ë³€ìˆ˜ì˜ íƒ€ì…ì´ EquipmentTypeì´ë¼ëŠ” Enumê°ì²´ì¸ë°,\n           targetìª½ ê°ì²´ì—ì„œëŠ” String typeìœ¼ë¡œ ì •ì˜ë˜ì–´ìˆëŠ” ê²½ìš° -> ë³„ë„ ì„¤ì • ì—†ìœ¼ë©´ Enum nameì´ ê·¸ëŒ€ë¡œ targetìœ¼ë¡œ ë§¤í•‘ë¨\n           ì´ ê²½ìš° Enumì—ì„œ ë³„ë„ë¡œ ì‚¬ìš©í•˜ê³  ì‹¶ì€ fullNameì„ ì§€ì •í–ˆë‹¤ê³  ê°€ì •í•˜ê³  ê·¸ê²ƒì„ ë§¤í•‘í•˜ëŠ” ë°©ë²•ì„ ì˜ˆë¡œ ë“¤ì—ˆìŒ */\n        @Mapping(source = \"condition\", target = \"product\", qualifiedByName = \"productToBaseProduct\")\n        /* â˜ source ê°ì²´ ìì²´ë¥¼ target ë³€ìˆ˜ì— ë§¤í•‘í•˜ëŠ”ë° ì‚¬ìš©í•  ìˆ˜ ìˆìŒ\n           ì´ ê²½ìš° equipmentTypeë³„ë¡œ ë§¤í•‘í•´ì•¼í•˜ëŠ” Product í´ë˜ìŠ¤ê°€ ë‹¤ë¥¸ ê²½ìš°ë¥¼ ê°€ì •í•˜ê³  ì˜ˆë¥¼ ë“¤ì—ˆìŒ */\n        @Mapping(source = \"condition.param\", target = \"params\")\n        /* â˜ ë‹¨ìˆœíˆ ë³€ìˆ˜ì˜ ì´ë¦„ë§Œ ë‹¤ë¥¸ ê²½ìš° ìœ„ì™€ ê°™ì´ ê°„ë‹¨í•˜ê²Œ ì •ì˜í•  ìˆ˜ ìˆìŒ\n           ì´ ê²½ìš° sourceì˜ paramì€ List<Param>ì´ê³  targetì— List<ParamDto> paramsë¡œ ì •ì˜ë˜ì–´ ìˆëŠ” ê²½ìš°ë¥¼ ê°€ì •í•˜ì˜€ê³ \n           MapStructì—ì„œ ì•Œì•„ì„œ ê°ì²´, ì½œë ‰ì…˜ ë§¤í•‘ì— í•„ìš”í•œ ë©”ì†Œë“œë¥¼ 2ê°œ ìƒì„±í•¨ */\n        ConditionDto toConditionDto(Condition condition);\n\n        //ë³€ìˆ˜ëª…, íƒ€ì… ë“±ì—ì„œ íŠ¹ì´ì‚¬í•­ì´ ì—†ëŠ” ê²½ìš° ì•„ë˜ì™€ ê°™ì´ ì¶”ìƒë©”ì†Œë“œ ì •ì˜ë§Œ í•´ë‘ë©´ ë§¤í•‘ ì½”ë“œê°€ ìƒì„±ëœë‹¤.\n        ProductChild1 toChild1(Product product);\n        ProductChild2 toChild2(Product product);\n\n        /* static method êµ¬í˜„\n         * toConditionDto ë©”ì†Œë“œì˜ ì²«ë²ˆì§¸ @Mapping ì„¤ì • ì¤‘ qualifiedByName ì†ì„±ì—ì„œ í˜¸ì¶œí•˜ê²Œ ë  ë©”ì†Œë“œë¥¼ êµ¬í˜„í•œ ì˜ì—­ì´ë‹¤.\n         * MapStructê°€ ë§¤í•‘ í´ë˜ìŠ¤ë¥¼ êµ¬í˜„í•´ì¤„ ë•Œ @Named ì–´ë…¸í…Œì´ì…˜ì— ì‘ì„±í•œ ì´ë¦„ìœ¼ë¡œ ì½”ë“œë¥¼ ì‘ì„±í•˜ê¸° ë•Œë¬¸ì— qualifiedByNameì´ë‘ ë§ì¶°ì¤˜ì•¼í•¨\n         */\n        @Named(\"equipmentTypeToString\")\n        static String equipmentTypeToString(EquipmentType equipmentType){\n            return equipmentType.getFullName();\n        }\n\n        @Named(\"productToBaseProduct\")\n        static BaseProduct productToBaseProduct(Condition condition){\n            BaseProduct returnProduct = null;\n            Product product = condition.getProduct();\n\n            switch (condition.getEquipmentType()){\n            case EQUIP1:\n                returnProduct = INSTANCE.toChild1(product);\n                break;\n            case EQUIP2:\n                returnProduct = INSTANCE.toChild2(product);\n                break;\n            }\n\n            return returnProduct;\n        }\n    }\n    ```\n\n3. ì»´íŒŒì¼ í›„ ìë™ ìƒì„±ëœ í´ë˜ìŠ¤ êµ¬ê²½\n\n    ë„ˆë¬´ ê¸¸ì–´ì„œ..ğŸ‘‰ [gist link](https://gist.github.com/m3rri/1c689ede6e8fdd112db1269966c96d87)\n\n4. 2ì—ì„œ ìƒì„±í•œ INSTANCEë¥¼ í†µí•´ ë©”ì†Œë“œ í˜¸ì¶œ\n\n    ```java\n    public ConditionDto getCondition(Long id){\n        ...\n        Condition condition = conditionRepository.findById(id);\n\n        return ConditionMapper.INSTANCE.toConditionDto(condition);\n    }\n    ```\n\n### MapStructì™€ ModelMapperì˜ ì°¨ì´ì  (=MapStructê°€ ë” ì¢‹ì€ ì´ìœ )\n\n-   ModelMapper\n    -   Collection, Enum íƒ€ì…ì˜ ë³€ìˆ˜ë¥¼ ë³€í™˜í•  ë•Œ ì‘ì„±í•˜ëŠ” ì½”ë“œê°€ ë„ˆë¬´ ì¥í™©í•¨\n    -   ëŸ°íƒ€ì„ì—ì„œ ì˜ˆì™¸ë¥¼ ë°˜í™˜í•¨\n    -   ë¬¸ì œê°€ ìˆì„ ë•Œ ë””ë²„ê¹…ì´ ë¶ˆê°€ëŠ¥í•¨\n-   MapStruct\n    -   Collection, Enum íƒ€ì… ë³€í™˜ ì½”ë“œê°€ ê°„ë‹¨í•¨\n    -   ì»´íŒŒì¼í•  ë•Œ ì˜ˆì™¸ë¥¼ ë°˜í™˜í•¨\n    -   ë””ë²„ê¹…ì´ ì‰¬ì›€ : _ì¸í„°í˜ì´ìŠ¤ë¡œ ë§¤í•‘í•  ë‚´ìš©ì„ ì •ì˜í•˜ë©´ ì»´íŒŒì¼ ì‹œ getter, setterë¥¼ ì‚¬ìš©í•œ í´ë˜ìŠ¤ë¥¼ ìë™ìƒì„±í•´ì£¼ê¸° ë•Œë¬¸ì—_\n-   Collection type ë³€í™˜ ì½”ë“œ ë¹„êµ\n    -   ì¡°íšŒ ê²°ê³¼ê°€ findAllì¸ ê²½ìš°\n        ```java\n        // ModelMapper\n        List<User> users = userRepository.getUsers();\n        List<UserDto> userList = users.stream()\n                .map(user -> modelMapper.map(user, UserDto.class))\n                .collect(Collectors.toList());\n        ```\n        ```java\n        // MapStruct\n        UserDto toUserDto(User user);\n        List<UserDto> toUserDtoList(List<User> users);\n        ```\n    -   ì¡°íšŒ ê²°ê³¼ê°€ findOneì¸ ê²½ìš°\n        ```java\n        // ModelMapper\n        User user = orderRepository.getOrdersGroupByUser();\n        List<OrderDto> orders = user.getOrders()\n                .map(order -> modelMapper.map(order, OrderDto.class))\n                .collect(Collectors.toList());\n        UserDto userDto = modelMapper.map(user, UserDto.class);\n        userDto.setOrders(orders);\n        ```\n        ```java\n        // MapStruct : findAllì—ì„œ ì‘ì„±í•œ toUserDtoë¡œ ì²˜ë¦¬ ê°€ëŠ¥\n        ```\n-   Enum type ë³€í™˜ ì½”ë“œ ë¹„êµ\n\n    -   Enum\n\n        ```java\n        @Getter\n        public enum Currency{\n            WON(\"ï¿¦\"),\n            DOLLAR(\"$\");\n\n            private String symbol;\n\n            Currency(String symbol){\n                this.symbol = symbol;\n            }\n        }\n        ```\n\n    -   ModelMapper\n\n        ```java\n        @Bean\n        public ModelMapper modelMapper(){\n            ModelMapper modelMapper = new ModelMapper();\n\n            Converter<Currency, String> currencyConverter = ctx -> ctx.getSource().getSymbol();\n            PropertiMap<Item, ItemDto> itemMap = new PropertyMap<>(){\n                protected void configure(){\n                    using(currencyConverter).map(source.getCurrency()).setCurrency(null);\n                }\n            }\n            modelMapper.addMappings(itemMap);\n\n            return modelMapper;\n        }\n        ```\n\n    -   MapStruct\n\n        ```java\n        @Mapping(source = \"item.currency\", target=\"currency\", qualifiedByName = \"currencyToSymbol\")\n        ItemDto toItemDto(Item item);\n\n        @Named(\"currencyToSymbol\")\n        static String currencyToSymbol(Currency currency){\n            return currency.getSymbol();\n        }\n        ```\n\n-   ì„±ëŠ¥ ì°¨ì´ : MapStruct > ModelMapper  \n     ì¶œì²˜ : [Java ë§¤í•‘ í”„ë ˆì„ì›Œí¬ì˜ ì„±ëŠ¥](https://recordsoflife.tistory.com/1251)\n\n### ê²°ë¡ \n\në‚œ ì´ì œ MapStruct ì—†ì´ JPAë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ëŠ” ëª¸ì´ ë˜ì—ˆë‹¤.\nìš°ë¦¬ë‚˜ë¼ì—ì„œëŠ” ModelMapperì˜ ì ìœ ìœ¨ì´ ë” ë†’ë‹¤ê³  í•˜ëŠ”ë° MapStruct ë§ì´ ì“°ë©´ ì¢‹ê² ë‹¤.\n\n### ì°¸ì¡°\n\nNHN Cloud Meetup [Object Mapping ì–´ë””ê¹Œì§€ í•´ë´¤ë‹ˆ?](https://meetup.nhncloud.com/posts/213)\n","title":"Java Bean Mapping library ì ìš© - MapStruct","date":"2023-05-26","category":["backend","spring"],"tag":["MapStruct","jpa","java"]},"prev":{"id":"20230221","title":"wsl.exe ì‹¤í–‰ë˜ì§€ ì•ŠìŒ","date":"2023-02-21","category":["OS","window"],"tag":["wsl","ubuntu"]},"next":null},"__N_SSG":true}