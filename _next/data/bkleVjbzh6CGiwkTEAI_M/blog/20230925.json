{"pageProps":{"post":{"id":"20230925","content":"\n## Bastion Host 로 구성된 EC2에서 mysql 사용\n\n### 적용 배경\n\n- dev 환경에서 stg 환경으로 RDS table을 이관하기 위해서 mysql dump 기능 사용\n- AWS Bastion Host 구성 및 RDS 구성이 완료되어있는 상황을 전제로 작성됨\n- window10 환경에서 wsl 설치 후 awscli 사용하여 명령어 실행\n\n### 1. `.pem` file 준비\n\n- window 환경에서 MySQL Workbench 사용을 위해 로컬에 `.pem` 파일을 저장해두었다.\n- wsl에서 윈도우에 저장된 파일같은 경우 `/mnt` 디렉토리 하위에서 조회 가능하지만 나중에 접속하려고 명령어 날리면 Permission 에러가 발생한다.\n- 따라서 wsl에서 바로 읽을 수 있는 위치로 파일 copy해둔다 ▶ 나중에 ~/.ssh 위치에 config 파일 만들거라서 같은 위치로 복사한 뒤 권한 처리 해두었음.\n  ```console\n  m3rri@hostname:/$ cp \"/mnt/h/원래 위치/key.pem\" ~/.ssh/\n  m3rri@hostname:/$ sudo chmod 400 ~/.ssh/key.pem\n  ```\n\n### 2. aws ssm 설치\n```console\nm3rri@hostname:/$ curl \"https://s3.amazonaws.com/session-manager-downloads/plugin/latest/ubuntu_64bit/session-manager-plugin.deb\" -o \"session-manager-plugin.deb\"\nm3rri@hostname:/$ sudo dpkg -i session-manager-plugin.deb\nm3rri@hostname:/$ session-manager-plugin\n\nThe Session Manager plugin was installed successfully. Use the AWS CLI to start a session.\n\nm3rri@hostname:/$\n```\n\n### 3. config 작성\n```console\nm3rri@hostname:/$ sudo vim config\n\nhost i-* mi-*\n  ProxyCommand sh -c \"aws ssm start-session --target %h --document-name AWS-StartSSHSession --parameters 'portNumber=%p'\"\n  User ec2-user\n  IdentityFile ./key.pem\n```\n- ec2-user : Bastion Host 환경의 EC2 user name임 꼭 ec2-user가 아닐 수 있음\n\n### 4. ssh 실행\n- EC2 console에서 인스턴스 ID 확인 필요\n  ![image](https://github.com/m3rri/m3rri.github.io/assets/37619441/c1bcd8f4-864b-45d5-9ddb-66c3d67b77c8)\n```console\nm3rri@hostname:/$ ssh i-*****************\nThe authenticity of host 'i-***************** (<no hostip for proxy command>)' can't be established.\nED25519 key fingerprint is SHA256:*****************/*****************.\nThis host key is known by the following other names/addresses:\n    ~/.ssh/known_hosts:1: [hashed name]\nAre you sure you want to continue connecting (yes/no/[fingerprint])? yes\nWarning: Permanently added 'i-*****************' (ED25519) to the list of known hosts.\nLast login: Mon Sep 25 01:31:20 2023 from 61.74.175.54\n\n       __|  __|_  )\n       _|  (     /   Amazon Linux 2 AMI\n      ___|\\___|___|\n\nhttps://aws.amazon.com/amazon-linux-2/\n23 package(s) needed for security, out of 49 available\nRun \"sudo yum update\" to apply all updates.\n```\n\n### 5. mysql 실행\n```console\n[ec2-user@ip-172-00-0-000 ~]$ mysql -u[username] -h[mysql host name] -P3306 -p[password]\nWelcome to the MariaDB monitor.  Commands end with ; or \\g.\nYour MySQL connection id is 426485\nServer version: 8.0.26 Source distribution\n\nCopyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.\n\nType 'help;' or '\\h' for help. Type '\\c' to clear the current input statement.\n\nMySQL [(none)]> use testdb;\nReading table information for completion of table and column names\nYou can turn off this feature to get a quicker startup with -A\n\nDatabase changed\nMySQL [testdb]> select * from user_info;\n```\n- mysql 명령어 실행 시 `-u`, `-h`, `-p`등의 옵션 뒤에 공백이 없어야함!(`-P3306` 참조)\n\n### 참조\n[musma - [실습] SSH처럼 위장하기 + 포트 포워딩 (고급)](https://musma.github.io/2019/11/29/about-aws-ssm.html)\n","title":"Bastion Host 사용하여 RDS 접속하기","date":"2023-09-25","category":["Cloud","aws"],"tag":["BastionHost","RDS"]},"prev":{"id":"20230526","title":"Java Bean Mapping library 적용 - MapStruct","date":"2023-05-26","category":["backend","spring"],"tag":["MapStruct","jpa","java"]},"next":{"id":"20240620","title":"기초 네트워크[유투브 조코딩 - 꼭 알아야 하는 네트워크 지식...(feat.강민철)","date":"2024-06-20","category":["infra","network"],"tag":["network","http"]},"nearPost":[{"id":"20240620","title":"기초 네트워크[유투브 조코딩 - 꼭 알아야 하는 네트워크 지식...(feat.강민철)","date":"2024-06-20","category":["infra","network"],"tag":["network","http"]},{"id":"20230526","title":"Java Bean Mapping library 적용 - MapStruct","date":"2023-05-26","category":["backend","spring"],"tag":["MapStruct","jpa","java"]},{"id":"20230221","title":"wsl.exe 실행되지 않음","date":"2023-02-21","category":["OS","window"],"tag":["wsl","ubuntu"]},{"id":"20230216","title":"Facade Pattern (파사드 패턴)","date":"2023-02-16","category":["SW","design pattern"],"tag":["oop","design pattern"]},{"id":"20230209","title":"[js] Default parameters of function & Spread syntax in object literals","date":"2023-02-09","category":["frontend","javascript"],"tag":["javascript","es5","default parameter","spread syntax"]}]},"__N_SSG":true}