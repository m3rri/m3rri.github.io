<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="/_next/static/css/35c28d56d191e153.css" as="style"/><link rel="stylesheet" href="/_next/static/css/35c28d56d191e153.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-63653cb569fe7944.js" defer=""></script><script src="/_next/static/chunks/framework-5f4595e5518b5600.js" defer=""></script><script src="/_next/static/chunks/main-a054bbf31fb90f6a.js" defer=""></script><script src="/_next/static/chunks/pages/_app-ff93f459f4f1ed07.js" defer=""></script><script src="/_next/static/chunks/655-6f539a740f2c10d9.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5BpostId%5D-a671c206328c4111.js" defer=""></script><script src="/_next/static/HhQDuI0ZKhy9LbixoRb6c/_buildManifest.js" defer=""></script><script src="/_next/static/HhQDuI0ZKhy9LbixoRb6c/_ssgManifest.js" defer=""></script><script src="/_next/static/HhQDuI0ZKhy9LbixoRb6c/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><div class="text-black"><header class="border-b border-deep"><nav class="py-2.5 px-2 bg-white"><div class="container flex flex-wrap justify-between items-center mx-auto"><a class="flex items-center" href="/"><span class="self-center text-xl text-default font-bold whitespace-nowrap dark:text-white">MERRI`s DEVELOG</span></a><button type="button" class="inline-flex justify-center items-center ml-3 rounded-lg md:hidden px-1 focus:outline-none focus:ring-2 focus:ring-light/20 dark:text-gray-400 dark:hover:text-white dark:focus:ring-gray-500"><span class="sr-only">Open main menu</span>ğŸ“š</button><div class="hidden w-full -mb-1.5 md:border-0 md:block md:w-auto md:mb-0"><ul class="divide-y divide-deep flex flex-col mt-4 -mx-2 md:flex-row md:m-0 md:text-sm md:font-medium md:divide-x md:divide-y-0"><li class="md:px-5 md:py-3.5 md:-my-2.5"></li><li class="md:px-5 md:py-3.5 md:-my-2.5 hover:bg-light duration-500"><button data-dropdown-for="dropdown_Blog" class="flex justify-between items-center py-2 pr-4 pl-3 w-full text-highlight font-medium hover:border-light duration-500 md:py-3.5 md:px-5 md:-my-3.5 md:-mx-5 md:w-auto dark:text-gray-400 dark:hover:text-white dark:focus:text-white dark:border-gray-700 dark:hover:bg-gray-700">Blog<!-- --> ğŸ—‚</button><div id="dropdown_Blog" class="hidden relative md:absolute z-0 md:z-10 w-auto bg-white divide-y divide-light/50 bg-white border border-deep mx-5 my-2 md:m-1.5"><ul class="py-1 text-sm"><span class="pl-2 text-black text-xs font-bold">TOOL</span><li><a class="block py-2 px-4  hover:bg-light/20 duration-300" href="/blog/git">Git</a></li></ul><ul class="py-1 text-sm"><span class="pl-2 text-black text-xs font-bold">OS</span><li><a class="block py-2 px-4  hover:bg-light/20 duration-300" href="/blog/linux">Linux</a></li></ul><ul class="py-1 text-sm"><span class="pl-2 text-black text-xs font-bold">BACKEND</span><li><a class="block py-2 px-4  hover:bg-light/20 duration-300" href="/blog/spring">Spring</a></li><li><a class="block py-2 px-4  hover:bg-light/20 duration-300" href="/blog/java">Java</a></li></ul><ul class="py-1 text-sm"><span class="pl-2 text-black text-xs font-bold">IDEA</span><li><a class="block py-2 px-4  hover:bg-light/20 duration-300" href="/blog/intellij">Intellij</a></li></ul></div></li><li class="md:px-5 md:py-3.5 md:-my-2.5 hover:bg-light duration-500"><a class="block py-2 pr-4 pl-3  md:py-3.5 md:px-5 md:-my-3.5 md:-mx-5 hover:text-black" href="/portfolio">Portfolio<!-- --> ğŸ“„</a></li><li class="md:px-5 md:py-3.5 md:-my-2.5 hover:bg-light duration-500"><a class="block py-2 pr-4 pl-3  md:py-3.5 md:px-5 md:-my-3.5 md:-mx-5 hover:text-black" href="/about">About<!-- --> ğŸ“„</a></li><li class="md:px-5 md:py-3.5 md:-my-2.5"></li></ul></div></div></nav></header><div class="mainArea flex flex-row"><div class="aside-non-role h-full flex-auto w-2"></div><main class="px-3 w-full lg:w-[1000px] my-4 flex-none"><div class="-my-4 -mb-9 -mx-3 lg:mx-0 border-0 lg:border-l lg:border-r border-deep "><header class="p-2 space-y-1 border-b border-deep"><h1 class="text-3xl text-black font-bold">JPA ìƒì†ê´€ê³„ ë§¤í•‘ ì „ëµ</h1><div class="text-sm text-aaa">2022-10-28</div></header><div class="p-2"><div class="category-area text-sm">ğŸ“‚ <!-- -->backend &gt; spring</div><div class="tag-area text-sm">ğŸ§¶ #<!-- -->jpa #@inheritance #@MappedSuperclass</div></div><main class="markdown-body py-3 px-5 lg:px-2"><h2>JPA Entity ìƒì† ê´€ê³„ ë§¤í•‘ ì „ëµ</h2>
<p><strong>ğŸŒŸ ì¶œì²˜ : <a href="https://ict-nroo.tistory.com/128">ê°œë°œìì˜ ê¸°ë¡ìŠµê´€ - [JPA] ìƒì†ê´€ê³„ ë§¤í•‘ ì „ëµ(@Inheritance, @DiscriminatorColumn)</a></strong></p>
<h3>ê³µë¶€í•˜ê²Œ ëœ ë°°ê²½</h3>
<blockquote>
<ol>
<li>Spring í”„ë¡œì íŠ¸ì— <code>JPA Entity</code>ì— ìƒì„±, ìˆ˜ì • ì‹œê°„ ê´€ë¦¬ë¥¼ ìœ„í•œ ì¹¼ëŸ¼ì´ ì¡´ì¬.</li>
<li>êµ­ì œí™”ë¥¼ ìœ„í•´ <code>UTC</code>ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì‚¼ì•„ BEì—ì„œ ì²˜ë¦¬í•˜ê³  í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì‹œê°„ì„ ìš”ì²­ ì‹œ FEì—ì„œ ì§€ì—­í™”í•˜ê¸° ìœ„í•´ <code>@PrePersist</code>, <code>@PreUpdate</code> ì–´ë…¸í…Œì´ì…˜ì´ ì ìš©ëœ ë©”ì†Œë“œë¥¼ ì‚¬ìš©.</li>
<li>í”„ë¡œì íŠ¸ì—ì„œ ê´€ë¦¬í•˜ëŠ” Entityê°€ í™•ëŒ€ë  ê²½ìš°ì—ë„ ê¸°ì¤€ ì‹œê°„ì„ UTCë¡œ ì¼ì •í•˜ê²Œ ê°€ì ¸ê°€ê¸° ìœ„í•´ì„œ ìœ„ ë©”ì†Œë“œë¥¼ ìƒì†ë°›ë„ë¡ BaseEntityë¥¼ ì„¤ê³„</li>
<li>ê·¸ëƒ¥ ìƒì†í•˜ë‹ˆê¹Œ <code>@Table</code> ì–´ë…¸í…Œì´ì…˜ì— ì„¤ì •í•œ í…Œì´ë¸”ì´ ì•„ë‹ˆë¼ <code>baseEntity</code>ë¼ëŠ” ì´ë¦„ì˜ í…Œì´ë¸”ì´ ìƒˆë¡œ ìƒê¸°ë©´ì„œ <code>DTYPE</code>ì´ë¼ëŠ” ì¹¼ëŸ¼ì— ì›ë˜ í…Œì´ë¸” entityëª…ì´ ì…ë ¥ ë¨</li>
</ol>
</blockquote>
<h3>DBì˜ <code>super type</code> :arrow_right: <code>sub type</code>ë¥¼ ë¬¼ë¦¬ ëª¨ë¸ë¡œ êµ¬í˜„í•˜ëŠ” 3ê°€ì§€ ë°©ë²•</h3>
<ul>
<li><strong>Enttiy Diagram</strong><br/>
<img src="https://user-images.githubusercontent.com/94826141/197458035-7ef7dd46-e3c9-4a9b-aea0-a0d096252da2.png" alt="diagram"/></li>
<li><strong>Entity.class</strong>
<pre><code class="language-java">@Entity
public class BaseEntity {
    @Id
    @Column(name = &quot;tuple_id&quot;)
    private String tupleId;
    @Column(name = &quot;create_time&quot;)
    private Timestamp createTime;
    @Column(name = &quot;update_time&quot;)
    private Timestamp updateTime;

    @PrePersist
    public void beforeAdd() {
        LocalDateTime ldt = LocalDateTime.ofInstant(Instant.now(), ZoneOffset.UTC);
        this.createTime = Timestamp.valueOf(ldt);
    }

    @PreUpdate
    public void beforeUpdate() {
        LocalDateTime ldt = LocalDateTime.ofInstant(Instant.now(), ZoneOffset.UTC);
        this.updateTime = Timestamp.valueOf(ldt);
    }
}
</code></pre>
</li>
</ul>
<ol>
<li><code>JOINED</code> : ê°ê°ì˜ í…Œì´ë¸”ë¡œ ìƒì„±í•œ ë’¤ ì¡°ì¸í•˜ëŠ” ì „ëµ</li>
</ol>
<ul>
<li>implement code<!-- -->
<pre><code class="language-java">@Entity
@Inheritance(strategy = InheritanceType.JOINED)
@DiscriminatorColumn(name=&quot;DTYPE&quot;) //defaultê°€ DTYPE
public class BaseEntity {
    @Id
    @Column(name = &quot;tuple_id&quot;)
    private String tupleId;
    @Column(name = &quot;create_time&quot;)
    private Timestamp createTime;
    @Column(name = &quot;update_time&quot;)
    private Timestamp updateTime;

    @PrePersist
    ..
}
</code></pre>
</li>
<li><code>base_item</code>, <code>app_a</code>, <code>app_b</code>, <code>app_c</code> 4ê°œì˜ í…Œì´ë¸”ì´ ê´€ë¦¬ë˜ë©° base_item í…Œì´ë¸”ì—ë§Œ tuple_id, create_time, update_time ì˜ ë°ì´í„°ê°€ ì €ì¥ëœë‹¤. tuple_id ì¹¼ëŸ¼ì´ PKì´ì FKê°€ ëœë‹¤.</li>
<li>í•„ìˆ˜ë¡œ ì„ ì–¸í•´ì•¼ í•˜ëŠ” <code>@DiscriminatorColumn</code>ìœ¼ë¡œ ìƒì„±ëœ <code>DTYPE</code> ì¹¼ëŸ¼ì€ <code>sub type</code> í…Œì´ë¸” ì¤‘ ì–´ë–¤ ê³³ì— ë°ì´í„°ê°€ ìƒì„±ë˜ì—ˆëŠ”ì§€ ëª…ì‹œí•˜ëŠ” ì—­í• ì´ë©°, defaultëŠ” ì—”í‹°í‹° í´ë˜ìŠ¤ ì´ë¦„ì´ ì‚¬ìš©ëœë‹¤ (<code>appA</code>, <code>appB</code>, <code>appC</code>)</li>
<li><code>app_a</code> í…Œì´ë¸”ì— ì‹ ê·œ ë°ì´í„°ë¥¼ ì €ì¥í•˜ë©´ insert queryê°€ ë‘ ë²ˆ ì‹¤í–‰ë˜ë©°, <code>app_a</code> ë°ì´í„°ë¥¼ ìƒì„± ì‹œê°„ê³¼ í•¨ê»˜ ì¡°íšŒí•˜ê³ ì í•˜ë©´ ì¡°ì¸ì´ í•„ìš”í•´ì§„ë‹¤.</li>
<li>DB ê´€ì ì—ì„œ ê°€ì¥ ì •ê·œí™”ëœ êµ¬ì¡°ì´ë©° ë©”ëª¨ë¦¬ ì¸¡ë©´ì—ì„œë„ ì‡ì ì´ ìˆë‹¤ê³  í•œë‹¤.</li>
</ul>
<ol start="2">
<li><code>SINGLE_TABLE</code> : í†µí•© í…Œì´ë¸”ë¡œ ë³€í™˜í•˜ëŠ” ë‹¨ì¼ í…Œì´ë¸” ì „ëµ</li>
</ol>
<ul>
<li>implement code<!-- -->
<pre><code class="language-java">@Entity
@Inheritance(strategy = InheritanceType.SINGLE_TABLE)
//@DiscriminatorColumn default DTYPEìœ¼ë¡œ ì¹¼ëŸ¼ ìƒì„±í•´ì¤Œ
public class BaseEntity {
    @Id
    @Column(name = &quot;tuple_id&quot;)
    private String tupleId;
    @Column(name = &quot;create_time&quot;)
    private Timestamp createTime;
    @Column(name = &quot;update_time&quot;)
    private Timestamp updateTime;

    @PrePersist
    ...
}
</code></pre>
</li>
<li>ê·œëª¨ë‚˜ ë³µì¡ë„ê°€ í¬ì§€ ì•Šì€ ì—”í‹°í‹°ë“¤ì˜ ê²½ìš° ëª¨ë“  ì—”í‹°í‹°ì˜ ì¹¼ëŸ¼ì„ í•œ í…Œì´ë¸”ì— ë‹¤ ì €ì¥í•˜ê³  <code>DTYPE</code>ìœ¼ë¡œ êµ¬ë¶„í•  ìˆ˜ ìˆë‹¤.</li>
<li>insert queryë„ í•œ ë²ˆì´ê³ , ì¡°ì¸ë„ í•„ìš”ê°€ ì—†ë‹¤.</li>
<li>ì§„í–‰ ì¤‘ì¸ í”„ë¡œì íŠ¸ì—ì„œëŠ” appA~appC ì— ëŒ€í•œ ì¹¼ëŸ¼ ë³€ê²½ì´ ë¹ˆë²ˆí•˜ê²Œ ì¼ì–´ë‚˜ë©° DBë¥¼ ì›¹ì—ì„œë§Œ ì ‘ê·¼í•˜ëŠ” êµ¬ì¡°ê°€ ì•„ë‹ˆê¸° ë•Œë¬¸ì— í•œ í…Œì´ë¸”ì— ëª°ì•„ë‘ê³  <code>DTYPE</code>ìœ¼ë¡œ êµ¬ë¶„í•˜ì—¬ ì‚¬ìš©í•˜ê¸°ì—ëŠ” ë¬´ë¦¬ê°€ ìˆë‹¤.</li>
</ul>
<ol start="3">
<li><strong><code>TABLE_PER_CLASS</code> : êµ¬í˜„ í´ë˜ìŠ¤ë§ˆë‹¤ í…Œì´ë¸”ì„ ìƒì„±í•˜ëŠ” ì „ëµ</strong></li>
</ol>
<ul>
<li>implement code<!-- -->
<pre><code class="language-java">@Entity
@Inheritance(strategy = InheritanceType.TABLE_PER_CLASS)
public class BaseEntity {
    @Id
    @Column(name = &quot;tuple_id&quot;)
    private String tupleId;
    @Column(name = &quot;create_time&quot;)
    private Timestamp createTime;
    @Column(name = &quot;update_time&quot;)
    private Timestamp updateTime;

    @PrePersist
    ...
}
</code></pre>
</li>
<li>1ë²ˆ JOINED ì „ëµê³¼ ìœ ì‚¬í•´ë³´ì´ì§€ë§Œ <code>super type</code> ì—”í‹°í‹°ì˜ ì¹¼ëŸ¼ë“¤ì„ <code>sub type</code>ì˜ ì—”í‹°í‹° ëª¨ë‘ì— ë™ì¼í•˜ê²Œ ìƒì„±í•˜ì—¬ <code>app_a</code>, <code>app_b</code>, <code>app_c</code> ì´ 3ê°œì˜ í…Œì´ë¸”ì„ ê´€ë¦¬í•˜ê²Œ ëœë‹¤.</li>
<li><code>super type</code> ì—”í‹°í‹°ë¡œ ì ‘ê·¼í•  ê²½ìš° <code>app_a</code>~<code>app_c</code> ë¥¼ <code>UNION</code> ì—°ì‚°ìë¥¼ ì‚¬ìš©í•˜ì—¬ ì¡°íšŒí•˜ê¸° ë•Œë¬¸ì— ì´ëŸ° ê²½ìš° ì„±ëŠ¥ì´ ì¢‹ë‹¤ê³  í•  ìˆ˜ëŠ” ì—†ë‹¤.</li>
</ul>
<hr/>
<h2>ì–´ë…¸í…Œì´ì…˜ ë“± ì„¤ì •ê°’ ì •ë¦¬</h2>
<p><strong>ğŸŒŸ ì¶œì²˜ : <a href="https://victorydntmd.tistory.com/209">victolee - [Spring JPA] ìƒì†(JOINED ì „ëµì„ ì¤‘ì‹¬ìœ¼ë¡œ)</a></strong></p>
<h3>ìƒì† ê´€ê³„ ê´€ë ¨</h3>
<ul>
<li>@Inheritance<!-- -->
<ul>
<li>ì–´ë–¤ ìƒì† ì „ëµì„ ì‚¬ìš©í•  ê²ƒì¸ì§€ ëª…ì‹œ</li>
</ul>
</li>
<li>@DiscriminatorColumn<!-- -->
<ul>
<li><code>super type</code> ì—”í‹°í‹°ì—ì„œ ì–´ë–¤ ì¹¼ëŸ¼ì„ ì‚¬ìš©í•˜ì—¬ <code>sub type</code> ì—”í‹°í‹°ë¥¼ êµ¬ë¶„í•  ê²ƒì¸ì§€ ëª…ì‹œ</li>
</ul>
</li>
<li>@DiscriminatorValue<!-- -->
<ul>
<li>ìœ„ì˜ ì¹¼ëŸ¼ì—ì„œ <code>sub type</code> ì—”í‹°í‹° ë³„ë¡œ ê°’ì„ ê°€ì§€ë„ë¡ ì§€ì •</li>
<li>DBì—ì„œ table column valueë¡œ ë“¤ì–´ê°ˆ ê°’ì´ê¸° ë•Œë¬¸ì— ì˜ì–´/í•œê¸€ êµ¬ë¶„ ì—†ì´ ì‚¬ìš© ê°€ëŠ¥</li>
</ul>
</li>
</ul>
<h3>ê°ì²´ ë§¤í•‘ ê´€ë ¨</h3>
<ul>
<li>@MappedSuperclass<!-- -->
<ul>
<li>ê°ì²´ ì§€í–¥ì ìœ¼ë¡œëŠ” ìƒì† ê´€ê³„ë¥¼ ìœ ì§€í•˜ì§€ë§Œ ì‹¤ì œ êµ¬í˜„ë  entityì—ëŠ” ì˜í–¥ì„ ì£¼ì§€ ì•Šê¸° ìœ„í•´ì„œ ì‚¬ìš©</li>
<li><code>super type</code> ì—”í‹°í‹°ì—ì„œ <code>@Entity</code> ëŒ€ì‹  <code>@MappedSuperclass</code>ë¡œ ì„ ì–¸<!-- -->
<ul>
<li>ì‹¤ì œë¡œ êµ¬í˜„ ë  ì—”í‹°í‹°ê°€ ì•„ë‹ˆê¸° ë•Œë¬¸ì— ì¶”ìƒí´ë˜ìŠ¤ë¡œ ì„ ì–¸</li>
<li><code>@ID</code> ë¡œ ì„ ì–¸í•´ì„œ ì‚¬ìš©í•  id ì¹¼ëŸ¼ë„ í•„ìš”ì—†ìŒ</li>
</ul>
</li>
<li>ìœ„ì˜ ì˜ˆì œì—ì„œ <code>BaseEntity</code>ì— ì´ ì–´ë…¸í…Œì´ì…˜ì„ ì ìš©í•˜ë©´ <code>BaseEntity</code>ì— ëŒ€í•œ ì—”í‹°í‹°ëŠ” ìƒì„±ë˜ì§€ ì•Šê³ , <code>TABLE_PER_CLASS</code> ì „ëµì„ ì ìš©í•œ ê²ƒê³¼ ìœ ì‚¬í•˜ê²Œ <code>BaseEntity</code>ì— ìˆëŠ” ì¹¼ëŸ¼ì„ ëª¨ë‘ ìì‹ <code>sub type</code> ì—”í‹°í‹°ì— í¬í•¨í•˜ì—¬ ìƒì„±</li>
</ul>
</li>
<li>@AttributeOverride / @AttributeOverrides<!-- -->
<ul>
<li><code>@MappedSuperclass</code>ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš°, ë¶€ëª¨ í´ë˜ìŠ¤ì˜ íŠ¹ì • ì¹¼ëŸ¼ì„ overrideí•˜ë ¤ê³  í•  ë•Œ ì‚¬ìš©</li>
</ul>
<pre><code class="language-java">@MappedSuperclass
public abstract class BaseEntity{
    @Column(name = &quot;create_time&quot;)
    private Timestamp createTime;
    @Column(name = &quot;update_time&quot;)
    private Timestamp updateTime;
}

@Entity
@AttributeOverride(name=&quot;updateTime&quot;, column=@Column(name=&quot;app_a_update_time&quot;))
public class AppA extends BaseEntity{
  private String appAVar;
}

@Entity
@AttributeOverrides({
  @AttributeOverride(name=&quot;createTime&quot;, column=@Column(name=&quot;app_b_create_time&quot;)),
  @AttributeOverride(name=&quot;updateTime&quot;, column=@Column(name=&quot;app_b_update_time&quot;)),
})
public class AppB extends BaseEntity{
  private String appBVar;
}
</code></pre>
</li>
</ul>
<hr/>
<h3>ê²°ë¡ </h3>
<ul>
<li>ì›ë˜ ì ìš©í•˜ë ¤ê³  í–ˆë˜ ë‚´ìš©ì€ <code>@MappedSuperclass</code>ë¥¼ ì‚¬ìš©í•˜ì—¬ ì ìš©í•˜ì˜€ìŒ</li>
<li>ê¸°ì¡´ì— QueryDslë¡œ ì§ì ‘ ì¡°ì¸í•˜ì—¬ select í•˜ë„ë¡ ì„¤ê³„í–ˆë˜ ë¶€ë¶„ì„ JAVA code ìƒì—ì„œ ëª…ì‹œì ìœ¼ë¡œ ìƒì† ê´€ê³„ì— ìˆìŒì„ íŒŒì•…í•  ìˆ˜ ìˆë„ë¡ ê´€ë ¨ìˆëŠ” ì—”í‹°í‹°ë“¤ì— JOINED ì „ëµì„ ì ìš©í•˜ì˜€ìŒ</li>
</ul>
<h3>ì°¸ì¡°</h3>
<ul>
<li>Entityì—ì„œëŠ” ì—¬ëŸ¬ ë³€ìˆ˜ì— @Idë¥¼ ì„ ì–¸í•˜ì—¬ ë³µí•©í‚¤ë¡œì¨ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ”ë°, ì´ ê²½ìš° @GeneratedValueë¥¼ ì‚¬ìš©í•  ìˆ˜ê°€ ì—†ë‹¤. ì§ì ‘ í• ë‹¹ë§Œ ê°€ëŠ¥<br/>
<!-- -->(ì¶œì²˜ : <a href="https://www.icatpark.com/entry/jpa-%EB%B3%B5%ED%95%A9%ED%82%A4%EC%97%90%EC%84%9C-auto-increment">catpark&#x27;s something new - jpa ë³µí•©í‚¤ì—ì„œ auto increment</a>)</li>
</ul></main><div class="pt-2 px-2 lg:px-0 text-default">/end of <!-- -->JPA ìƒì†ê´€ê³„ ë§¤í•‘ ì „ëµ</div><footer class="flex flex-col md:flex-row pt-1 px-2 lg:px-0 border-t border-deep"><div class="flex-1"><a class="pl-1 hover:text-aaa" href="/blog/20221020">ğŸ‘ˆ Ubuntu ëª…ë ¹ì–´ ì •ë¦¬</a></div><div class="text-right"><a class="pl-1 hover:text-aaa" href="/blog/20221109">Ubuntu ëª…ë ¹ì–´ ì •ë¦¬(2) ğŸ‘‰</a></div></footer></div></main><div class="aside-non-role h-full flex-auto w-2"></div></div><footer class="p-4 space-y-2 bg-white border-t border-deep mt-5 w-full text-black tracking-widest"><div><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="inline" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M502.3 190.8c3.9-3.1 9.7-.2 9.7 4.7V400c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V195.6c0-5 5.7-7.8 9.7-4.7 22.4 17.4 52.1 39.5 154.1 113.6 21.1 15.4 56.7 47.8 92.2 47.6 35.7.3 72-32.8 92.3-47.6 102-74.1 131.6-96.3 154-113.7zM256 320c23.2.4 56.6-29.2 73.4-41.4 132.7-96.3 142.8-104.7 173.4-128.7 5.8-4.5 9.2-11.5 9.2-18.9v-19c0-26.5-21.5-48-48-48H48C21.5 64 0 85.5 0 112v19c0 7.4 3.4 14.3 9.2 18.9 30.6 23.9 40.7 32.4 173.4 128.7 16.8 12.2 50.2 41.8 73.4 41.4z"></path></svg> m3rri17@gmail.com</div><div><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 496 512" class="inline" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg><a target="_blank" href="https://github.com/m3rri"> https://github.com/m3rri</a></div><div>Â©2022 KimHyeRi. All rights reserved.</div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"id":"20221028","content":"\n## JPA Entity ìƒì† ê´€ê³„ ë§¤í•‘ ì „ëµ\n**ğŸŒŸ ì¶œì²˜ : [ê°œë°œìì˜ ê¸°ë¡ìŠµê´€ - [JPA] ìƒì†ê´€ê³„ ë§¤í•‘ ì „ëµ(@Inheritance, @DiscriminatorColumn)](https://ict-nroo.tistory.com/128)**\n### ê³µë¶€í•˜ê²Œ ëœ ë°°ê²½\n\n\u003e 1. Spring í”„ë¡œì íŠ¸ì— `JPA Entity`ì— ìƒì„±, ìˆ˜ì • ì‹œê°„ ê´€ë¦¬ë¥¼ ìœ„í•œ ì¹¼ëŸ¼ì´ ì¡´ì¬.\n\u003e 2. êµ­ì œí™”ë¥¼ ìœ„í•´ `UTC`ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì‚¼ì•„ BEì—ì„œ ì²˜ë¦¬í•˜ê³  í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì‹œê°„ì„ ìš”ì²­ ì‹œ FEì—ì„œ ì§€ì—­í™”í•˜ê¸° ìœ„í•´ `@PrePersist`, `@PreUpdate` ì–´ë…¸í…Œì´ì…˜ì´ ì ìš©ëœ ë©”ì†Œë“œë¥¼ ì‚¬ìš©.\n\u003e 3. í”„ë¡œì íŠ¸ì—ì„œ ê´€ë¦¬í•˜ëŠ” Entityê°€ í™•ëŒ€ë  ê²½ìš°ì—ë„ ê¸°ì¤€ ì‹œê°„ì„ UTCë¡œ ì¼ì •í•˜ê²Œ ê°€ì ¸ê°€ê¸° ìœ„í•´ì„œ ìœ„ ë©”ì†Œë“œë¥¼ ìƒì†ë°›ë„ë¡ BaseEntityë¥¼ ì„¤ê³„\n\u003e 4. ê·¸ëƒ¥ ìƒì†í•˜ë‹ˆê¹Œ `@Table` ì–´ë…¸í…Œì´ì…˜ì— ì„¤ì •í•œ í…Œì´ë¸”ì´ ì•„ë‹ˆë¼ `baseEntity`ë¼ëŠ” ì´ë¦„ì˜ í…Œì´ë¸”ì´ ìƒˆë¡œ ìƒê¸°ë©´ì„œ `DTYPE`ì´ë¼ëŠ” ì¹¼ëŸ¼ì— ì›ë˜ í…Œì´ë¸” entityëª…ì´ ì…ë ¥ ë¨\n\n### DBì˜ `super type` :arrow_right: `sub type`ë¥¼ ë¬¼ë¦¬ ëª¨ë¸ë¡œ êµ¬í˜„í•˜ëŠ” 3ê°€ì§€ ë°©ë²•\n* **Enttiy Diagram**  \n![diagram](https://user-images.githubusercontent.com/94826141/197458035-7ef7dd46-e3c9-4a9b-aea0-a0d096252da2.png)\n* **Entity.class**\n  ```java\n  @Entity\n  public class BaseEntity {\n      @Id\n      @Column(name = \"tuple_id\")\n      private String tupleId;\n      @Column(name = \"create_time\")\n      private Timestamp createTime;\n      @Column(name = \"update_time\")\n      private Timestamp updateTime;\n\n      @PrePersist\n      public void beforeAdd() {\n          LocalDateTime ldt = LocalDateTime.ofInstant(Instant.now(), ZoneOffset.UTC);\n          this.createTime = Timestamp.valueOf(ldt);\n      }\n\n      @PreUpdate\n      public void beforeUpdate() {\n          LocalDateTime ldt = LocalDateTime.ofInstant(Instant.now(), ZoneOffset.UTC);\n          this.updateTime = Timestamp.valueOf(ldt);\n      }\n  }\n  ```\n\n1. `JOINED` : ê°ê°ì˜ í…Œì´ë¸”ë¡œ ìƒì„±í•œ ë’¤ ì¡°ì¸í•˜ëŠ” ì „ëµ\n  * implement code\n    ```java\n    @Entity\n    @Inheritance(strategy = InheritanceType.JOINED)\n    @DiscriminatorColumn(name=\"DTYPE\") //defaultê°€ DTYPE\n    public class BaseEntity {\n        @Id\n        @Column(name = \"tuple_id\")\n        private String tupleId;\n        @Column(name = \"create_time\")\n        private Timestamp createTime;\n        @Column(name = \"update_time\")\n        private Timestamp updateTime;\n\n        @PrePersist\n        ..\n    }\n    ```\n  * `base_item`, `app_a`, `app_b`, `app_c` 4ê°œì˜ í…Œì´ë¸”ì´ ê´€ë¦¬ë˜ë©° base_item í…Œì´ë¸”ì—ë§Œ tuple_id, create_time, update_time ì˜ ë°ì´í„°ê°€ ì €ì¥ëœë‹¤. tuple_id ì¹¼ëŸ¼ì´ PKì´ì FKê°€ ëœë‹¤.\n  * í•„ìˆ˜ë¡œ ì„ ì–¸í•´ì•¼ í•˜ëŠ” `@DiscriminatorColumn`ìœ¼ë¡œ ìƒì„±ëœ `DTYPE` ì¹¼ëŸ¼ì€ `sub type` í…Œì´ë¸” ì¤‘ ì–´ë–¤ ê³³ì— ë°ì´í„°ê°€ ìƒì„±ë˜ì—ˆëŠ”ì§€ ëª…ì‹œí•˜ëŠ” ì—­í• ì´ë©°, defaultëŠ” ì—”í‹°í‹° í´ë˜ìŠ¤ ì´ë¦„ì´ ì‚¬ìš©ëœë‹¤ (`appA`, `appB`, `appC`)\n  * `app_a` í…Œì´ë¸”ì— ì‹ ê·œ ë°ì´í„°ë¥¼ ì €ì¥í•˜ë©´ insert queryê°€ ë‘ ë²ˆ ì‹¤í–‰ë˜ë©°, `app_a` ë°ì´í„°ë¥¼ ìƒì„± ì‹œê°„ê³¼ í•¨ê»˜ ì¡°íšŒí•˜ê³ ì í•˜ë©´ ì¡°ì¸ì´ í•„ìš”í•´ì§„ë‹¤.\n  * DB ê´€ì ì—ì„œ ê°€ì¥ ì •ê·œí™”ëœ êµ¬ì¡°ì´ë©° ë©”ëª¨ë¦¬ ì¸¡ë©´ì—ì„œë„ ì‡ì ì´ ìˆë‹¤ê³  í•œë‹¤.\n2. `SINGLE_TABLE` : í†µí•© í…Œì´ë¸”ë¡œ ë³€í™˜í•˜ëŠ” ë‹¨ì¼ í…Œì´ë¸” ì „ëµ\n  * implement code\n    ```java\n    @Entity\n    @Inheritance(strategy = InheritanceType.SINGLE_TABLE)\n    //@DiscriminatorColumn default DTYPEìœ¼ë¡œ ì¹¼ëŸ¼ ìƒì„±í•´ì¤Œ\n    public class BaseEntity {\n        @Id\n        @Column(name = \"tuple_id\")\n        private String tupleId;\n        @Column(name = \"create_time\")\n        private Timestamp createTime;\n        @Column(name = \"update_time\")\n        private Timestamp updateTime;\n\n        @PrePersist\n        ...\n    }\n    ```\n  * ê·œëª¨ë‚˜ ë³µì¡ë„ê°€ í¬ì§€ ì•Šì€ ì—”í‹°í‹°ë“¤ì˜ ê²½ìš° ëª¨ë“  ì—”í‹°í‹°ì˜ ì¹¼ëŸ¼ì„ í•œ í…Œì´ë¸”ì— ë‹¤ ì €ì¥í•˜ê³  `DTYPE`ìœ¼ë¡œ êµ¬ë¶„í•  ìˆ˜ ìˆë‹¤.\n  * insert queryë„ í•œ ë²ˆì´ê³ , ì¡°ì¸ë„ í•„ìš”ê°€ ì—†ë‹¤.\n  * ì§„í–‰ ì¤‘ì¸ í”„ë¡œì íŠ¸ì—ì„œëŠ” appA~appC ì— ëŒ€í•œ ì¹¼ëŸ¼ ë³€ê²½ì´ ë¹ˆë²ˆí•˜ê²Œ ì¼ì–´ë‚˜ë©° DBë¥¼ ì›¹ì—ì„œë§Œ ì ‘ê·¼í•˜ëŠ” êµ¬ì¡°ê°€ ì•„ë‹ˆê¸° ë•Œë¬¸ì— í•œ í…Œì´ë¸”ì— ëª°ì•„ë‘ê³  `DTYPE`ìœ¼ë¡œ êµ¬ë¶„í•˜ì—¬ ì‚¬ìš©í•˜ê¸°ì—ëŠ” ë¬´ë¦¬ê°€ ìˆë‹¤.\n3. **`TABLE_PER_CLASS` : êµ¬í˜„ í´ë˜ìŠ¤ë§ˆë‹¤ í…Œì´ë¸”ì„ ìƒì„±í•˜ëŠ” ì „ëµ**  \n  * implement code\n    ```java\n    @Entity\n    @Inheritance(strategy = InheritanceType.TABLE_PER_CLASS)\n    public class BaseEntity {\n        @Id\n        @Column(name = \"tuple_id\")\n        private String tupleId;\n        @Column(name = \"create_time\")\n        private Timestamp createTime;\n        @Column(name = \"update_time\")\n        private Timestamp updateTime;\n\n        @PrePersist\n        ...\n    }\n    ```\n  * 1ë²ˆ JOINED ì „ëµê³¼ ìœ ì‚¬í•´ë³´ì´ì§€ë§Œ `super type` ì—”í‹°í‹°ì˜ ì¹¼ëŸ¼ë“¤ì„ `sub type`ì˜ ì—”í‹°í‹° ëª¨ë‘ì— ë™ì¼í•˜ê²Œ ìƒì„±í•˜ì—¬ `app_a`, `app_b`, `app_c` ì´ 3ê°œì˜ í…Œì´ë¸”ì„ ê´€ë¦¬í•˜ê²Œ ëœë‹¤.\n  * `super type` ì—”í‹°í‹°ë¡œ ì ‘ê·¼í•  ê²½ìš° `app_a`~`app_c` ë¥¼ `UNION` ì—°ì‚°ìë¥¼ ì‚¬ìš©í•˜ì—¬ ì¡°íšŒí•˜ê¸° ë•Œë¬¸ì— ì´ëŸ° ê²½ìš° ì„±ëŠ¥ì´ ì¢‹ë‹¤ê³  í•  ìˆ˜ëŠ” ì—†ë‹¤.\n\n---\n\n## ì–´ë…¸í…Œì´ì…˜ ë“± ì„¤ì •ê°’ ì •ë¦¬\n**ğŸŒŸ ì¶œì²˜ : [victolee - [Spring JPA] ìƒì†(JOINED ì „ëµì„ ì¤‘ì‹¬ìœ¼ë¡œ)](https://victorydntmd.tistory.com/209)**\n### ìƒì† ê´€ê³„ ê´€ë ¨\n  * @Inheritance\n    * ì–´ë–¤ ìƒì† ì „ëµì„ ì‚¬ìš©í•  ê²ƒì¸ì§€ ëª…ì‹œ\n  * @DiscriminatorColumn\n    * `super type` ì—”í‹°í‹°ì—ì„œ ì–´ë–¤ ì¹¼ëŸ¼ì„ ì‚¬ìš©í•˜ì—¬ `sub type` ì—”í‹°í‹°ë¥¼ êµ¬ë¶„í•  ê²ƒì¸ì§€ ëª…ì‹œ\n  * @DiscriminatorValue\n    * ìœ„ì˜ ì¹¼ëŸ¼ì—ì„œ `sub type` ì—”í‹°í‹° ë³„ë¡œ ê°’ì„ ê°€ì§€ë„ë¡ ì§€ì •\n    * DBì—ì„œ table column valueë¡œ ë“¤ì–´ê°ˆ ê°’ì´ê¸° ë•Œë¬¸ì— ì˜ì–´/í•œê¸€ êµ¬ë¶„ ì—†ì´ ì‚¬ìš© ê°€ëŠ¥\n### ê°ì²´ ë§¤í•‘ ê´€ë ¨\n  * @MappedSuperclass\n    * ê°ì²´ ì§€í–¥ì ìœ¼ë¡œëŠ” ìƒì† ê´€ê³„ë¥¼ ìœ ì§€í•˜ì§€ë§Œ ì‹¤ì œ êµ¬í˜„ë  entityì—ëŠ” ì˜í–¥ì„ ì£¼ì§€ ì•Šê¸° ìœ„í•´ì„œ ì‚¬ìš©\n    * `super type` ì—”í‹°í‹°ì—ì„œ `@Entity` ëŒ€ì‹  `@MappedSuperclass`ë¡œ ì„ ì–¸\n      * ì‹¤ì œë¡œ êµ¬í˜„ ë  ì—”í‹°í‹°ê°€ ì•„ë‹ˆê¸° ë•Œë¬¸ì— ì¶”ìƒí´ë˜ìŠ¤ë¡œ ì„ ì–¸\n      * `@ID` ë¡œ ì„ ì–¸í•´ì„œ ì‚¬ìš©í•  id ì¹¼ëŸ¼ë„ í•„ìš”ì—†ìŒ\n    * ìœ„ì˜ ì˜ˆì œì—ì„œ `BaseEntity`ì— ì´ ì–´ë…¸í…Œì´ì…˜ì„ ì ìš©í•˜ë©´ `BaseEntity`ì— ëŒ€í•œ ì—”í‹°í‹°ëŠ” ìƒì„±ë˜ì§€ ì•Šê³ , `TABLE_PER_CLASS` ì „ëµì„ ì ìš©í•œ ê²ƒê³¼ ìœ ì‚¬í•˜ê²Œ `BaseEntity`ì— ìˆëŠ” ì¹¼ëŸ¼ì„ ëª¨ë‘ ìì‹ `sub type` ì—”í‹°í‹°ì— í¬í•¨í•˜ì—¬ ìƒì„±\n  * @AttributeOverride / @AttributeOverrides\n    * `@MappedSuperclass`ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš°, ë¶€ëª¨ í´ë˜ìŠ¤ì˜ íŠ¹ì • ì¹¼ëŸ¼ì„ overrideí•˜ë ¤ê³  í•  ë•Œ ì‚¬ìš©\n    ```java\n    @MappedSuperclass\n    public abstract class BaseEntity{\n        @Column(name = \"create_time\")\n        private Timestamp createTime;\n        @Column(name = \"update_time\")\n        private Timestamp updateTime;\n    }\n\n    @Entity\n    @AttributeOverride(name=\"updateTime\", column=@Column(name=\"app_a_update_time\"))\n    public class AppA extends BaseEntity{\n      private String appAVar;\n    }\n\n    @Entity\n    @AttributeOverrides({\n      @AttributeOverride(name=\"createTime\", column=@Column(name=\"app_b_create_time\")),\n      @AttributeOverride(name=\"updateTime\", column=@Column(name=\"app_b_update_time\")),\n    })\n    public class AppB extends BaseEntity{\n      private String appBVar;\n    }\n    ```\n---\n\n### ê²°ë¡ \n* ì›ë˜ ì ìš©í•˜ë ¤ê³  í–ˆë˜ ë‚´ìš©ì€ `@MappedSuperclass`ë¥¼ ì‚¬ìš©í•˜ì—¬ ì ìš©í•˜ì˜€ìŒ\n* ê¸°ì¡´ì— QueryDslë¡œ ì§ì ‘ ì¡°ì¸í•˜ì—¬ select í•˜ë„ë¡ ì„¤ê³„í–ˆë˜ ë¶€ë¶„ì„ JAVA code ìƒì—ì„œ ëª…ì‹œì ìœ¼ë¡œ ìƒì† ê´€ê³„ì— ìˆìŒì„ íŒŒì•…í•  ìˆ˜ ìˆë„ë¡ ê´€ë ¨ìˆëŠ” ì—”í‹°í‹°ë“¤ì— JOINED ì „ëµì„ ì ìš©í•˜ì˜€ìŒ\n\n### ì°¸ì¡°\n* Entityì—ì„œëŠ” ì—¬ëŸ¬ ë³€ìˆ˜ì— @Idë¥¼ ì„ ì–¸í•˜ì—¬ ë³µí•©í‚¤ë¡œì¨ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ”ë°, ì´ ê²½ìš° @GeneratedValueë¥¼ ì‚¬ìš©í•  ìˆ˜ê°€ ì—†ë‹¤. ì§ì ‘ í• ë‹¹ë§Œ ê°€ëŠ¥  \n(ì¶œì²˜ : [catpark's something new - jpa ë³µí•©í‚¤ì—ì„œ auto increment](https://www.icatpark.com/entry/jpa-%EB%B3%B5%ED%95%A9%ED%82%A4%EC%97%90%EC%84%9C-auto-increment))\n","title":"JPA ìƒì†ê´€ê³„ ë§¤í•‘ ì „ëµ","date":"2022-10-28","category":["backend","spring"],"tag":["jpa","@inheritance","@MappedSuperclass"]},"prev":{"id":"20221020","title":"Ubuntu ëª…ë ¹ì–´ ì •ë¦¬","date":"2022-10-20","category":["os","linux"],"tag":["command"]},"next":{"id":"20221109","title":"Ubuntu ëª…ë ¹ì–´ ì •ë¦¬(2)","date":"2022-11-09","category":["os","linux"],"tag":["command"]}},"__N_SSG":true},"page":"/blog/[postId]","query":{"postId":"20221028"},"buildId":"HhQDuI0ZKhy9LbixoRb6c","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>