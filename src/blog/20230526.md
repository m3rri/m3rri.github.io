---
title: "Java Bean Mapping library ì ìš© - MapStruct"
date: "2023-05-26"
category:
    - backend
    - spring
tag:
    - MapStruct
    - jpa
    - java
---

## MapStructë¡œ dto ë§¤í•‘ ì§€ì˜¥ íƒˆì¶œ

### ì ìš© ë°°ê²½

-   í”„ë¡œì íŠ¸ ê°œë°œ ì¤‘ ë³€ìˆ˜ê°€ 40ê°œ ì´ìƒì´ë˜ëŠ” í…Œì´ë¸”ì„ ì¡°íšŒí•´ì„œ DTOë¡œ ë³€í™˜ í›„ ë¦¬í„´í•´ì¤˜ì•¼í•˜ëŠ” APIë¥¼ ë§Œë‚¬ë‹¤
-   getter setter ì¢ì¢ íƒ€ì´í•‘í•  ìƒê°ì— ì •ì‹ ì´ ì•„ë“í•´ì ¸ì„œ êµ¬ê¸€ë§ìœ¼ë¡œ Entity to Dto ë¥¼ ê²€ìƒ‰í–ˆë‹¤
-   ModelMapper ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë°œê²¬ í›„ ì ìš©í•´ë³´ë ¤ëŠ”ë° ë‚˜ë‘ ë„ˆë¬´ ì•ˆë§ì•„ì„œ ë‹¤ë¥¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì°¾ì•„ë³´ì•˜ê³  ê·¸ê²ƒì´ MapStructì´ë‹¤

### MapStruct ì‹œì‘í•˜ê¸°

1. ì˜ì¡´ì„± ì¶”ê°€í•˜ê¸° `build.gradle`

    lombok ì‚¬ìš©í•˜ëŠ” ê²½ìš° ì‘ì„± ìˆœì„œê°€ ë§¤ìš° ì¤‘ìš”í•˜ë‹¤ ğŸ‘‰ lombok ì´í›„ì— ì •ì˜

    ```gradle
    dependencies {
        ...
        implementation 'org.projectlombok:lombok'
        annotationProcessor 'org.projectlombok:lombok'
        implementation 'org.mapstruct:mapstruct:1.5.3.Final'
        annotationProcessor 'org.mapstruct:mapstruct-processor:1.5.3.Final'
        ...
    }
    ```

2. Mapper interface ì‘ì„±

    ```java
    import org.mapstruct.Mapper;
    import org.mapstruct.Mapping;
    import org.mapstruct.factory.Mappers;

    @Mapper //ì–´ë…¸í…Œì´ì…˜ ì ìš©
    public interface ConditionsMapper {
        ConditionsMapper INSTANCE = Mappers.getMapper(ConditionsMapper.class);
        // Mappers.getMapper()ë¡œ ì‹±ê¸€í†¤ ìƒì„±í•˜ì—¬ INSTANCEë¥¼ í˜¸ì¶œí•´ì„œ ì‚¬ìš©

        /* abstract method ì •ì˜
         * @Mapping : í•´ë‹¹ ì–´ë…¸í…Œì´ì…˜ì„ í†µí•´ ë³€ìˆ˜ ì´ë¦„ë§Œìœ¼ë¡œ ìƒì„±ëœ getter, setterë§Œìœ¼ë¡œ ë§¤í•‘ì´ ë¶ˆê°€ëŠ¥í•œ ê²½ìš°ë¥¼ ì •ì˜
         *  * source : methodì˜ íŒŒë¼ë¯¸í„°ì¤‘ì—ì„œ ì–´ë–¤ íŒŒë¼ë¯¸í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ ë§¤í•‘í•  ê²ƒì¸ì§€ ëª…ì‹œí•˜ë©´ ë¨
              ì˜ˆì‹œ ì½”ë“œì—ì„œëŠ” method íŒŒë¼ë¯¸í„°ê°€ 1ê°œì´ì§€ë§Œ, 2ê°œ ì´ìƒì˜ ê°ì²´ë¥¼ ë°›ì•„ì„œ í•˜ë‚˜ì˜ target ê°ì²´ë¡œ ë§¤í•‘í•˜ëŠ” ê²½ìš°ë„ ì •ì˜í•  ìˆ˜ ìˆë‹¤.
              ë‹¨, í•˜ë‚˜ì˜ @Mapping source ì†ì„±ì—ì„œ í•˜ë‚˜ì˜ íŒŒë¼ë¯¸í„° ê°ì²´ë§Œ ë‹¤ë£° ìˆ˜ ìˆìŒ -> @Mapping ì—¬ëŸ¬ê°œë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ
         *  * target : methodì˜ ë¦¬í„´ íƒ€ì…
         */
        @Mapping(source = "condition.equipmentType", target = "equipmentType", qualifiedByName = "equipmentTypeToString")
        /* â˜ sourceìª½ ê°ì²´ì—ì„œ equipmentTypeì´ë¼ëŠ” ë³€ìˆ˜ì˜ íƒ€ì…ì´ EquipmentTypeì´ë¼ëŠ” Enumê°ì²´ì¸ë°,
           targetìª½ ê°ì²´ì—ì„œëŠ” String typeìœ¼ë¡œ ì •ì˜ë˜ì–´ìˆëŠ” ê²½ìš° -> ë³„ë„ ì„¤ì • ì—†ìœ¼ë©´ Enum nameì´ ê·¸ëŒ€ë¡œ targetìœ¼ë¡œ ë§¤í•‘ë¨
           ì´ ê²½ìš° Enumì—ì„œ ë³„ë„ë¡œ ì‚¬ìš©í•˜ê³  ì‹¶ì€ fullNameì„ ì§€ì •í–ˆë‹¤ê³  ê°€ì •í•˜ê³  ê·¸ê²ƒì„ ë§¤í•‘í•˜ëŠ” ë°©ë²•ì„ ì˜ˆë¡œ ë“¤ì—ˆìŒ */
        @Mapping(source = "condition", target = "product", qualifiedByName = "productToBaseProduct")
        /* â˜ source ê°ì²´ ìì²´ë¥¼ target ë³€ìˆ˜ì— ë§¤í•‘í•˜ëŠ”ë° ì‚¬ìš©í•  ìˆ˜ ìˆìŒ
           ì´ ê²½ìš° equipmentTypeë³„ë¡œ ë§¤í•‘í•´ì•¼í•˜ëŠ” Product í´ë˜ìŠ¤ê°€ ë‹¤ë¥¸ ê²½ìš°ë¥¼ ê°€ì •í•˜ê³  ì˜ˆë¥¼ ë“¤ì—ˆìŒ */
        @Mapping(source = "condition.param", target = "params")
        /* â˜ ë‹¨ìˆœíˆ ë³€ìˆ˜ì˜ ì´ë¦„ë§Œ ë‹¤ë¥¸ ê²½ìš° ìœ„ì™€ ê°™ì´ ê°„ë‹¨í•˜ê²Œ ì •ì˜í•  ìˆ˜ ìˆìŒ
           ì´ ê²½ìš° sourceì˜ paramì€ List<Param>ì´ê³  targetì— List<ParamDto> paramsë¡œ ì •ì˜ë˜ì–´ ìˆëŠ” ê²½ìš°ë¥¼ ê°€ì •í•˜ì˜€ê³ 
           MapStructì—ì„œ ì•Œì•„ì„œ ê°ì²´, ì½œë ‰ì…˜ ë§¤í•‘ì— í•„ìš”í•œ ë©”ì†Œë“œë¥¼ 2ê°œ ìƒì„±í•¨ */
        ConditionDto toConditionDto(Condition condition);

        //ë³€ìˆ˜ëª…, íƒ€ì… ë“±ì—ì„œ íŠ¹ì´ì‚¬í•­ì´ ì—†ëŠ” ê²½ìš° ì•„ë˜ì™€ ê°™ì´ ì¶”ìƒë©”ì†Œë“œ ì •ì˜ë§Œ í•´ë‘ë©´ ë§¤í•‘ ì½”ë“œê°€ ìƒì„±ëœë‹¤.
        ProductChild1 toChild1(Product product);
        ProductChild2 toChild2(Product product);

        /* static method êµ¬í˜„
         * toConditionDto ë©”ì†Œë“œì˜ ì²«ë²ˆì§¸ @Mapping ì„¤ì • ì¤‘ qualifiedByName ì†ì„±ì—ì„œ í˜¸ì¶œí•˜ê²Œ ë  ë©”ì†Œë“œë¥¼ êµ¬í˜„í•œ ì˜ì—­ì´ë‹¤.
         * MapStructê°€ ë§¤í•‘ í´ë˜ìŠ¤ë¥¼ êµ¬í˜„í•´ì¤„ ë•Œ @Named ì–´ë…¸í…Œì´ì…˜ì— ì‘ì„±í•œ ì´ë¦„ìœ¼ë¡œ ì½”ë“œë¥¼ ì‘ì„±í•˜ê¸° ë•Œë¬¸ì— qualifiedByNameì´ë‘ ë§ì¶°ì¤˜ì•¼í•¨
         */
        @Named("equipmentTypeToString")
        static String equipmentTypeToString(EquipmentType equipmentType){
            return equipmentType.getFullName();
        }

        @Named("productToBaseProduct")
        static BaseProduct productToBaseProduct(Condition condition){
            BaseProduct returnProduct = null;
            Product product = condition.getProduct();

            switch (condition.getEquipmentType()){
            case EQUIP1:
                returnProduct = INSTANCE.toChild1(product);
                break;
            case EQUIP2:
                returnProduct = INSTANCE.toChild2(product);
                break;
            }

            return returnProduct;
        }
    }
    ```

3. ì»´íŒŒì¼ í›„ ìë™ ìƒì„±ëœ í´ë˜ìŠ¤ êµ¬ê²½

    ë„ˆë¬´ ê¸¸ì–´ì„œ..ğŸ‘‰ [gist link](https://gist.github.com/m3rri/1c689ede6e8fdd112db1269966c96d87)

4. 2ì—ì„œ ìƒì„±í•œ INSTANCEë¥¼ í†µí•´ ë©”ì†Œë“œ í˜¸ì¶œ

    ```java
    public ConditionDto getCondition(Long id){
        ...
        Condition condition = conditionRepository.findById(id);

        return ConditionMapper.INSTANCE.toConditionDto(condition);
    }
    ```

### MapStructì™€ ModelMapperì˜ ì°¨ì´ì  (=MapStructê°€ ë” ì¢‹ì€ ì´ìœ )

-   ModelMapper
    -   Collection, Enum íƒ€ì…ì˜ ë³€ìˆ˜ë¥¼ ë³€í™˜í•  ë•Œ ì‘ì„±í•˜ëŠ” ì½”ë“œê°€ ë„ˆë¬´ ì¥í™©í•¨
    -   ëŸ°íƒ€ì„ì—ì„œ ì˜ˆì™¸ë¥¼ ë°˜í™˜í•¨
    -   ë¬¸ì œê°€ ìˆì„ ë•Œ ë””ë²„ê¹…ì´ ë¶ˆê°€ëŠ¥í•¨
-   MapStruct
    -   Collection, Enum íƒ€ì… ë³€í™˜ ì½”ë“œê°€ ê°„ë‹¨í•¨
    -   ì»´íŒŒì¼í•  ë•Œ ì˜ˆì™¸ë¥¼ ë°˜í™˜í•¨
    -   ë””ë²„ê¹…ì´ ì‰¬ì›€ : _ì¸í„°í˜ì´ìŠ¤ë¡œ ë§¤í•‘í•  ë‚´ìš©ì„ ì •ì˜í•˜ë©´ ì»´íŒŒì¼ ì‹œ getter, setterë¥¼ ì‚¬ìš©í•œ í´ë˜ìŠ¤ë¥¼ ìë™ìƒì„±í•´ì£¼ê¸° ë•Œë¬¸ì—_
-   Collection type ë³€í™˜ ì½”ë“œ ë¹„êµ
    -   ì¡°íšŒ ê²°ê³¼ê°€ findAllì¸ ê²½ìš°
        ```java
        // ModelMapper
        List<User> users = userRepository.getUsers();
        List<UserDto> userList = users.stream()
                .map(user -> modelMapper.map(user, UserDto.class))
                .collect(Collectors.toList());
        ```
        ```java
        // MapStruct
        UserDto toUserDto(User user);
        List<UserDto> toUserDtoList(List<User> users);
        ```
    -   ì¡°íšŒ ê²°ê³¼ê°€ findOneì¸ ê²½ìš°
        ```java
        // ModelMapper
        User user = orderRepository.getOrdersGroupByUser();
        List<OrderDto> orders = user.getOrders()
                .map(order -> modelMapper.map(order, OrderDto.class))
                .collect(Collectors.toList());
        UserDto userDto = modelMapper.map(user, UserDto.class);
        userDto.setOrders(orders);
        ```
        ```java
        // MapStruct : findAllì—ì„œ ì‘ì„±í•œ toUserDtoë¡œ ì²˜ë¦¬ ê°€ëŠ¥
        ```
-   Enum type ë³€í™˜ ì½”ë“œ ë¹„êµ

    -   Enum

        ```java
        @Getter
        public enum Currency{
            WON("ï¿¦"),
            DOLLAR("$");

            private String symbol;

            Currency(String symbol){
                this.symbol = symbol;
            }
        }
        ```

    -   ModelMapper

        ```java
        @Bean
        public ModelMapper modelMapper(){
            ModelMapper modelMapper = new ModelMapper();

            Converter<Currency, String> currencyConverter = ctx -> ctx.getSource().getSymbol();
            PropertiMap<Item, ItemDto> itemMap = new PropertyMap<>(){
                protected void configure(){
                    using(currencyConverter).map(source.getCurrency()).setCurrency(null);
                }
            }
            modelMapper.addMappings(itemMap);

            return modelMapper;
        }
        ```

    -   MapStruct

        ```java
        @Mapping(source = "item.currency", target="currency", qualifiedByName = "currencyToSymbol")
        ItemDto toItemDto(Item item);

        @Named("currencyToSymbol")
        static String currencyToSymbol(Currency currency){
            return currency.getSymbol();
        }
        ```

-   ì„±ëŠ¥ ì°¨ì´ : MapStruct > ModelMapper  
     ì¶œì²˜ : [Java ë§¤í•‘ í”„ë ˆì„ì›Œí¬ì˜ ì„±ëŠ¥](https://recordsoflife.tistory.com/1251)

### ê²°ë¡ 

ë‚œ ì´ì œ MapStruct ì—†ì´ JPAë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ëŠ” ëª¸ì´ ë˜ì—ˆë‹¤.
ìš°ë¦¬ë‚˜ë¼ì—ì„œëŠ” ModelMapperì˜ ì ìœ ìœ¨ì´ ë” ë†’ë‹¤ê³  í•˜ëŠ”ë° MapStruct ë§ì´ ì“°ë©´ ì¢‹ê² ë‹¤.

### ì°¸ì¡°

NHN Cloud Meetup [Object Mapping ì–´ë””ê¹Œì§€ í•´ë´¤ë‹ˆ?](https://meetup.nhncloud.com/posts/213)
